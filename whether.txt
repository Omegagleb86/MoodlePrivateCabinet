<p>
    <script type="text/javascript">
        // <![CDATA[
        "use strict"

        function weeksBetween(start, end) {
            var d = new Date(start);
            d.setHours(0, 0, 0, 0);
            return Math.floor((end - d) / (7 * 24 * 60 * 60 * 1000));
        }

        function daysBetween(start, end) {
            var d = new Date(start);
            d.setHours(0, 0, 0, 0);
            return Math.floor((end - d) / (24 * 60 * 60 * 1000));
        }

        function getMondayOfWeek(date) {
            var d = new Date(date);
            d.setDate(date.getDate() - ((date.getDay() + 8) % 7 - 2));
            return d;
        }

        function makeDaysTail(cur, next) {
            var days = daysBetween(cur, next);
            if (Math.floor(days % 100 / 10) == 1 || days % 10 > 4 || days % 10 == 0) return (" осталось " + days + " дней");
            else
                return (days % 10 == 1 ? (" остался " + days + " день") : (" осталось " + days + " дня"));
        }
        const y1 = 2024,
            y2 = y1 + 1,
            sem1Start = new Date(y1, 8, 1),
            sem1End = new Date(y1, 11, 31),
            ses1Start = new Date(y2, 0, 9),
            ses1End = new Date(y2, 0, 22),
            sem2Start = new Date(y2, 1, 3),
            sem2End = new Date(y2, 1, 3 + 7 * 18 - 1),
            ses2Start = new Date(y2, 1, 3 + 7 * 18),
            ses2End = new Date(y2, 1, 3 + 7 * 18 + 7 * 3 - 1),
            pracStart = new Date(y2, 1, 3 + 7 * 18 + 7 * 3),
            pracEnd = new Date(y2, 1, 3 + 7 * 18 + 7 * 3 + 7 * 4);
        var past = new Date;

        function defineWeek(d) {
            var s = getMondayOfWeek(sem1Start),
                n = weeksBetween(s, d),
                wt = n % 2 ? "знаменатель" : "числитель",
                msg1, msg2, msg3, msgb = "До начала ";
            if (d < sem1Start) msg1 = "Летние каникулы", msg3 = msgb + "учебного года" + makeDaysTail(d, sem1Start);
            else if (d <= sem1End) msg1 = "Осенний семестр, " + (n + 1) + "-я неделя, <u>" + wt + "</u>",
                msg2 = (n >= 16) ? "<b>Зачетная неделя</b>" : msgb + "зачетной недели" + makeDaysTail(d, new Date(s.getFullYear(), s.getMonth(), s.getDate() + 16 * 7)),
                msg3 = msgb + "зимней сессии" + makeDaysTail(d, ses1Start);
            else if (d < ses1Start) msg1 = "Осенний семестр закончился", msg3 = msgb + "зимней сессии" + makeDaysTail(d, ses1Start);
            else if (d <= ses1End) msg1 = "Зимняя сессия", msg3 = msgb + "зимних каникул" + makeDaysTail(d, new Date(ses1End.getFullYear(), ses1End.getMonth(), ses1End.getDate() + 1));
            else if (d < sem2Start) msg1 = "Зимние каникулы", msg3 = msgb + "весеннего семестра" + makeDaysTail(d, sem2Start);
            else if (d <= sem2End) s = getMondayOfWeek(sem2Start), n = weeksBetween(s, d), msg1 = "Весенний семестр, " + (n + 1) + "-я неделя, <u>" + wt + "</u>",
                msg2 = n >= 16 ? "<b>Зачетная неделя</b>" : msgb + "зачетной недели" + makeDaysTail(d, new Date(s.getFullYear(), s.getMonth(), s.getDate() + 16 * 7)),
                msg3 = msgb + "летней сессии" + makeDaysTail(d, ses2Start);
            else if (d < ses2Start) msg1 = "Весенний семестр закончился", msg3 = msgb + "летней сессии" + makeDaysTail(d, ses2Start);
            else if (d <= ses2End) msg1 = "Летняя сессия", msg3 = msgb + "летних каникул или практики" + makeDaysTail(d, new Date(ses2End.getFullYear(), ses2End.getMonth(), ses2End.getDate() + 1));
            else if (d <= pracEnd) msg1 = "Летние каникулы или практика";
            else msg1 = "Летние каникулы";
            msg1 = "<p align=\"center\"><b>" + msg1 + "</b>" + (msg2 ? ("<br>" + msg2) : "") + (msg3 ? ("<br>" + msg3) : "") + "</p>";
            return msg1;
        }

        function makeHM(t) {
            return (t >= 60 ? (String(Math.floor(t / 60)) + " ч. ") : "") + (t % 60) + " м.";
        }

        function defineTime(d) {
            const FIRST_START = 8 * 60 + 30,
                PAIR_LEN = 80,
                REST_LEN = 10,
                ADD3_LEN = 20,
                ADD6_LEN = 10;

            function startTime(n) {
                return FIRST_START + (n - 1) * (PAIR_LEN + REST_LEN) + (n > 3 ? ADD3_LEN : 0) + (n > 6 ? ADD6_LEN : 0);
            }

            function pairNumber(t) {
                var k = t - startTime(1) - (t >= startTime(7) ? ADD6_LEN : 0) - (t >= startTime(4) ? ADD3_LEN : 0);
                return Math.floor(1 + k / (PAIR_LEN + REST_LEN));
            }
            var msg1, msg2, t = d.getHours() * 60 + d.getMinutes();
            if (!d.getDay()) msg1 = "Занятий нет (воскресенье)", msg2 = "До начала 1-й пары осталось " + makeHM(startTime(1) + 24 * 60 - t);
            else if (t < startTime(1)) msg1 = "Занятия еще не начались", msg2 = "До начала 1-й пары осталось " + makeHM(startTime(1) - t);
            else if (t >= startTime(9) - REST_LEN) {
                msg1 = "Сегодня занятия закончились";
                if (d.getDay() < 6) msg2 = "До начала 1-й пары осталось " + makeHM(startTime(1) + 24 * 60 - t);
                else msg2 = "До начала 1-й пары (в понедельник) осталось " + makeHM(startTime(1) + 2 * 24 * 60 - t);
            } else {
                var n = pairNumber(t),
                    m = t - startTime(n);
                if (m < PAIR_LEN) msg1 = "Идет " + n + "-я пара", msg2 = "До перерыва осталось " + makeHM(PAIR_LEN - m);
                else msg1 = (n == 3 ? "Большой перерыв" : ("Перерыв после " + n + "-й пары")), msg2 = "До начала " + (n + 1) + "-й пары осталось " + makeHM(startTime(n + 1) - t);
            }
            return "<p align=\"center\">" + (msg1 ? ("<b>" + msg1 + "</b>") : "") + (msg1 && msg2 ? "<br>" : "") + (msg2 ? msg2 : "") + "</p>";
        }

        function isSemester(d) {
            return d >= sem1Start && d <= sem1End || d >= sem2Start && d <= sem2End;
        }

        function updateDateTimeInfo() {
            var now = new Date();
            if (now.getSeconds() != past.getSeconds()) {
                document.getElementById("idCurrentDateTime").innerHTML = now.toLocaleString();
                if (now.getDate() != past.getDate()) document.getElementById("idDefineDate").innerHTML = defineWeek(now);
                if (isSemester(past) && now.getMinutes() != past.getMinutes()) document.getElementById("idDefineTime").innerHTML = defineTime(now);
                past = now;
            }
            setTimeout(updateDateTimeInfo, 1000 - now.getMilliseconds());
        }
        past.setDate(past.getDate() - 1);
        past.setMinutes(past.getMinutes() - 1);
        past.setSeconds(past.getSeconds() - 1);
        document.write("<p align=\"center\" title=\"Локальное время пользователя\"><b>Сегодня <span id=\"idCurrentDateTime\"></span></b></p>");
        document.write("<div id=\"idDefineDate\"></div><div id=\"idDefineTime\"></div>");
        updateDateTimeInfo();
        document.write("<p align=\"center\" title=\"Утвержденные расписания на сайте СурГУ (раздел Учеба)\">");
        document.write("<a href=\"http://www.surgu.ru/raspisanie\" target=\"_blank\"><b>Посмотреть расписание</b></a></p>");
        document.write("<p align=\"center\" title=\"Подробнее на Яндекс.Погода\"><a href=\"https://yandex.ru/hava/973\" target=\"_blank\">");
        document.write("<img src=\"https://info.weather.yandex.net/973/2_white.ru.png?domain=ru\" border=\"0\" alt=\"Яндекс.Погода\" /></a></p>");
        // ]]>
    </script>
</p>
